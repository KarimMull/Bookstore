{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container mt-5">
    <!-- –ë–ª–æ–∫ —Å —Ç–æ–≤–∞—Ä–æ–º -->
    <div class="card mb-4 custom-shadow p-4">
        <div class="row d-flex align-items-center">
            <div class="col-md-5 text-center">
                <img src="{{ product.image.url }}" class="img-fluid" style="max-width: 400px; max-height: 600px;" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞">
            </div>
            <div class="col-md-7">
                <p class="text-muted mb-1">ID: {{ product.display_id }}</p>
                <h3 class="mb-3">{{ product.name }}</h3>
                <p class="mb-2">–¶–µ–Ω–∞: <strong>{{ product.sell_price }} ‚ÇΩ</strong></p>
                {% if product.discount %}
                    <p class="text-danger">–°–∫–∏–¥–∫–∞: {{ product.discount }}%</p>
                {% endif %}
                <p>{{ product.description }}</p>

                <a href="{% url 'cart:cart_add' %}" class="btn btn-dark mt-3 add-to-cart" data-product-id="{{ product.id }}">
                    {% csrf_token %}
                    –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
                </a>
            </div>
        </div>
    </div>

    <!-- –ë–ª–æ–∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ -->
    <div class="bg-white bg-opacity-90 rounded-3 shadow-lg p-4 mt-5 mb-5">
        <h4 class="mb-4">üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h4>

        {% if comments %}
            {% for comment in comments %}
                <div class="card mb-3 shadow-sm">
                    <div class="card-body d-flex">
                        <!-- –ê–≤–∞—Ç–∞—Ä -->
                        <div class="me-3">
                            {% if comment.user.image %}
                                <img src="{{ comment.user.image.url }}" class="rounded-circle" width="50" height="50" alt="avatar">
                            {% else %}
                                <img src="{% static 'deps/icons/default-avatar.png' %}" class="rounded-circle" width="50" height="50" alt="avatar">
                            {% endif %}
                        </div>

                        <!-- –ò–º—è –∏ —Ç–µ–∫—Å—Ç -->
                        <div class="w-100">
                            <div class="d-flex justify-content-between">
                                <h6 class="mb-1">{{ comment.user.username }}</h6>
                                <small class="text-muted">{{ comment.created_at|date:"d.m.Y H:i" }}</small>
                            </div>
                            <p class="mt-2 mb-0">{{ comment.text }}</p>
                        </div>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <p class="text-muted">–ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤.</p>
        {% endif %}

        {% if user.is_authenticated %}
            <form method="post" class="card p-4 shadow-sm mt-4">
                {% csrf_token %}
                <div class="mb-3">
                    {{ form.text.label_tag }}
                    {{ form.text }}
                    {% if form.text.errors %}
                        <div class="text-danger small mt-1">
                            {{ form.text.errors }}
                        </div>
                    {% endif %}
                </div>
                <button type="submit" class="btn btn-primary">üí¨ –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</button>
            </form>
        {% else %}
            <p class="text-muted mt-3">üîê –¢–æ–ª—å–∫–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –æ—Å—Ç–∞–≤–ª—è—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏.</p>
        {% endif %}
    </div>
</div>
{% endblock %}
